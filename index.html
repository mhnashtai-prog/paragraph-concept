<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>INTUITY – Paragraph Builder</title>

  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700;800;900&family=DM+Sans:wght@400;500;600;700;800&display=swap"
    rel="stylesheet"
  />

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
    color: #e5e5e7;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    padding-top: 3rem;
    overflow-x: hidden;
    position: relative;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background:
      radial-gradient(circle at 30% 20%, rgba(201, 169, 97, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 70% 80%, rgba(201, 169, 97, 0.08) 0%, transparent 45%);
    pointer-events: none;
    z-index: 0;
  }

  .main-container {
    position: relative;
    z-index: 1;
    max-width: 900px;
    width: 100%;
    display: flex;
    flex-direction: column;
    flex: 1;
  }

  /* HEADER */
  .header {
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .brand-logo {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 2.6rem;
    fontWeight: 900;
    background: linear-gradient(135deg, #C9A961 0%, #ffa050 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-transform: uppercase;
    letter-spacing: -0.02em;
    margin-bottom: 0.35rem;
  }

  .brand-subtitle {
    font-size: 0.95rem;
    color: #8e8e93;
    font-weight: 600;
    letter-spacing: 0.15em;
    text-transform: uppercase;
  }

  .brand-author {
    font-size: 0.8rem;
    color: #a1a1aa;
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }

  /* CENTRAL CARD */
  .central-card {
    background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
    border: 3px solid #C9A961;
    border-radius: 2rem;
    padding: 2rem 2rem 1.5rem;
    box-shadow:
      0 30px 80px rgba(0, 0, 0, 0.8),
      0 0 60px rgba(201, 169, 97, 0.3);
    position: relative;
    flex: 1;
    display: flex;
    flex-direction: column;
    margin-bottom: 1.5rem;
  }

  /* Top bar */
  .top-bar {
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .sentence-counter {
    font-size: 0.9rem;
    color: #cbd5f5;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  /* SEGMENTED CONTROL */
  .segmented-toggle {
    position: absolute;
    top: 1.5rem;
    right: 2rem;
    display: inline-flex;
    align-items: center;
    background: rgba(20, 20, 22, 0.32);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(201,169,97,0.35);
    border-radius: 999px;
    padding: 0.25rem;
    height: 38px;
    z-index: 20;
  }

  .segmented-bg {
    position: absolute;
    height: calc(100% - 6px);
    top: 3px;
    left: 3px;
    width: calc((100% - 6px) / 3);
    border-radius: 999px;
    background: linear-gradient(135deg, #C9A961 0%, #ffa050 100%);
    box-shadow: 0 0 15px rgba(201, 169, 97, 0.3);
    transition: transform 0.25s ease;
    z-index: 0;
  }

  .segmented-btn {
    position: relative;
    border: none;
    background: transparent;
    padding: 0 1rem;
    height: 100%;
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #e5e5ea;
    border-radius: 999px;
    cursor: pointer;
    z-index: 2;
    transition: color 0.25s;
  }

  .segmented-btn.active {
    color: #111;
  }

  /* PARAGRAPH AREA */
  .paragraph-area {
    flex: 1;
    padding: 1.5rem;
    border-radius: 1rem;
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid rgba(201, 169, 97, 0.35);
    font-size: 1rem;
    line-height: 1.75;
    color: #e5e7eb;
    min-height: 400px;
    margin-bottom: 1rem;
    position: relative;
  }

  .base-sentence-poster {
    background: linear-gradient(135deg, rgba(201, 169, 97, 0.15) 0%, rgba(255, 160, 80, 0.1) 100%);
    border: 3px solid #C9A961;
    border-radius: 1rem;
    padding: 1.8rem 1.5rem;
    margin-bottom: 1.5rem;
    position: relative;
    box-shadow: 
      0 8px 25px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .base-sentence-poster::before {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    background: linear-gradient(135deg, #C9A961 0%, #ffa050 100%);
    border-radius: 1rem;
    z-index: -1;
    opacity: 0.3;
    filter: blur(8px);
  }

  .base-sentence-label {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #C9A961 0%, #ffa050 100%);
    color: #0a0a0a;
    font-size: 0.7rem;
    font-weight: 800;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 0.35rem 1rem;
    border-radius: 999px;
    box-shadow: 0 4px 15px rgba(201, 169, 97, 0.4);
    z-index: 10;
  }

  .base-sentence-text {
    font-size: 1.15rem;
    line-height: 1.8;
    color: #fef3c7;
    font-weight: 600;
    text-align: center;
    position: relative;
    z-index: 2;
  }

  .base-sentence-icon {
    position: absolute;
    font-size: 4rem;
    opacity: 0.08;
    color: #C9A961;
    pointer-events: none;
  }

  .base-sentence-icon.top-left {
    top: 10px;
    left: 15px;
  }

  .base-sentence-icon.bottom-right {
    bottom: 10px;
    right: 15px;
  }

  .additional-text {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 2px dashed rgba(201, 169, 97, 0.3);
  }

  .opener-text {
    display: inline-block;
    background: rgba(52, 211, 153, 0.15);
    color: #6ee7b7;
    padding: 0.2rem 0.6rem;
    border-radius: 0.5rem;
    font-weight: 700;
    border: 1px solid rgba(52, 211, 153, 0.3);
    margin-right: 0.3rem;
  }

  .linking-word {
    color: #34d399;
    font-weight: 600;
  }

  /* PARAGRAPH ACTIONS */
  .paragraph-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 0.75rem;
  }

  .action-btn {
    padding: 0.55rem 1.2rem;
    border-radius: 999px;
    border: none;
    background: rgba(24, 24, 27, 0.95);
    color: #FDE68A;
    font-size: 0.75rem;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.25s;
  }

  .action-btn:hover {
    background: rgba(250, 204, 21, 0.14);
  }

  .opener-dropdown {
    position: relative;
  }

  .opener-menu {
    position: absolute;
    right: 0;
    bottom: 110%;
    background: rgba(15, 23, 42, 0.98);
    borderRadius: 0.75rem;
    border: 1px solid rgba(201,169,97,0.4);
    padding: 0.5rem;
    min-width: 260px;
    max-height: 260px;
    overflow-y: auto;
    display: none;
    z-index: 1000;
    box-shadow: 0 15px 40px rgba(0,0,0,0.7);
  }

  .opener-menu.show {
    display: block;
  }

  .opener-option {
    width: 100%;
    text-align: left;
    background: transparent;
    border: none;
    padding: 0.35rem 0.4rem;
    font-size: 0.78rem;
    color: #E5E7EB;
    cursor: pointer;
    border-radius: 0.5rem;
    transition: background 0.2s;
  }

  .opener-option:hover {
    background: rgba(201,169,97,0.18);
  }

  /* FOOTER */
  .footer {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: center;
  }

  /* TRANSFORM BUTTONS */
  .button-grid {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .stage-button {
    background: rgba(28, 28, 30, 0.95);
    border: 2px solid rgba(201, 169, 97, 0.3);
    border-radius: 0.75rem;
    padding: 0.6rem 1rem;
    cursor: pointer;
    min-height: 36px;
    transition: all 0.3s;
  }

  .stage-button:hover:not(.disabled) {
    border-color: #C9A961;
    transform: translateY(-2px);
  }

  .stage-button.disabled {
    opacity: 0.4;
    cursor: not-allowed;
    background: rgba(28, 28, 30, 0.5);
  }

  .stage-button-label {
    font-size: 0.75rem;
    letter-spacing: 0.04em;
    color: #cbd5e1;
    text-transform: uppercase;
    font-weight: 700;
  }

  /* NAVIGATION */
  .review-nav {
    display: flex;
    gap: 1rem;
    align-items: center;
    justify-content: center;
  }

  .nav-arrow {
    width: 36px;
    height: 36px;
    background: rgba(201, 169, 97, 0.2);
    border: 2px solid rgba(201, 169, 97, 0.4);
    border-radius: 50%;
    color: #C9A961;
    font-size: 1.1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .nav-dots {
    display: flex;
    gap: 0.5rem;
  }

  .nav-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(201, 169, 97, 0.3);
    border: 2px solid rgba(201, 169, 97, 0.5);
    cursor: pointer;
    transition: all 0.25s;
  }

  .nav-dot.active {
    background: #C9A961;
    box-shadow: 0 0 15px rgba(201, 169, 97, 0.8);
  }

  /* MODAL */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.92);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    z-index: 9999;
  }

  .modal-overlay.show {
    display: flex;
  }

  .modal-content-card {
    position: relative;
    z-index: 10000;
    background: linear-gradient(135deg, #1f1f1f 0%, #020617 100%);
    border-radius: 1.8rem;
    padding: 2.8rem 2.2rem 2.2rem;
    max-width: 900px;
    width: 100%;
    max-height: 85vh;
    overflow-y: auto;
    border: 2px solid rgba(201,169,97,0.7);
    box-shadow:
      0 0 30px rgba(0, 0, 0, 0.9),
      0 0 40px rgba(201, 169, 97, 0.4);
    color: #e5e7eb;
  }

  .modal-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.4rem;
    margin-bottom: 1rem;
    color: #facc15;
  }

  .modal-example-line {
    display: flex;
    align-items: center;
    gap: 0.7rem;
    margin-bottom: 0.55rem;
    flex-wrap: wrap;
  }

  .modal-example-line span:first-child {
    font-weight: 700;
    color: #facc15;
    min-width: 1.3rem;
  }

  .modal-example-line span:nth-child(2) {
    flex: 1;
  }

  .use-sentence-btn {
    border-radius: 999px;
    background: #ecfdf5;
    color: #15803d;
    padding: 0.25rem 0.7rem;
    font-size: 0.75rem;
    cursor: pointer;
    border: 1px solid #16a34a;
    white-space: nowrap;
    transition: all 0.2s ease;
  }

  .use-sentence-btn:hover {
    background: #bbf7d0;
    box-shadow: 0 0 10px rgba(22, 163, 74, 0.5);
  }

  /* MOBILE */
  @media (max-width: 768px) {
    body {
      padding: 0.5rem;
      padding-top: 0.5rem;
    }

    .header {
      margin-bottom: 0.6rem;
    }

    .brand-logo {
      font-size: 1.4rem;
    }

    .brand-subtitle {
      font-size: 0.6rem;
    }

    .brand-author {
      display: none;
    }

    .central-card {
      padding: 1.2rem 0.85rem 0.9rem;
      border-radius: 1rem;
      border-width: 2px;
      margin-bottom: 0.8rem;
    }

    .top-bar {
      margin-bottom: 0.5rem;
    }

    .sentence-counter {
      font-size: 0.68rem;
    }

    .segmented-toggle {
      position: static;
      transform: scale(0.7);
      transform-origin: right center;
      height: 28px;
      margin-bottom: 0.4rem;
    }

    .segmented-btn {
      padding: 0 0.65rem;
      font-size: 0.6rem;
    }

    .paragraph-area {
      padding: 1.2rem 1rem;
      font-size: 0.94rem;
      min-height: 260px;
      margin-bottom: 0.6rem;
      border: 2px solid #C9A961;
    }

    .base-sentence-poster {
      padding: 1.2rem 1rem;
      margin-bottom: 1rem;
      border-width: 2px;
    }

    .base-sentence-label {
      font-size: 0.6rem;
      padding: 0.3rem 0.8rem;
      top: -10px;
    }

    .base-sentence-text {
      font-size: 0.98rem;
      line-height: 1.65;
    }

    .base-sentence-icon {
      font-size: 2.5rem;
    }

    .base-sentence-icon.top-left {
      top: 8px;
      left: 10px;
    }

    .base-sentence-icon.bottom-right {
      bottom: 8px;
      right: 10px;
    }

    .action-btn {
      padding: 0.4rem 0.85rem;
      font-size: 0.64rem;
    }

    .button-grid {
      gap: 0.35rem;
    }

    .stage-button {
      padding: 0.5rem 0.7rem;
      border-width: 1.5px;
      border-radius: 0.65rem;
      border-color: rgba(201, 169, 97, 0.25);
    }

    .stage-button-label {
      font-size: 0.64rem;
    }

    .footer {
      gap: 0.7rem;
    }

    .review-nav {
      gap: 0.55rem;
    }

    .nav-arrow {
      width: 32px;
      height: 32px;
      font-size: 1rem;
      border-width: 1.5px;
    }

    .nav-dot {
      width: 9px;
      height: 9px;
      border-width: 1.5px;
    }

    .nav-dots {
      gap: 0.4rem;
    }

    .modal-content-card {
      padding: 1.6rem 1.1rem 1.2rem;
    }
  }
</style>
</head>
<body>

<div class="main-container">

  <!-- HEADER -->
  <div class="header">
    <h1 class="brand-logo">INTUITY</h1>
    <p class="brand-subtitle">Sentence → Paragraph Transformation</p>
    <p class="brand-author">Majid Nashtai</p>
  </div>

  <!-- CENTRAL CARD -->
  <div class="central-card">

    <!-- Top bar: Counter + Toggle -->
    <div class="top-bar">
      <p class="sentence-counter" id="sentenceCounter">1 / 10</p>
    </div>

    <!-- Segmented Control -->
    <div class="segmented-toggle" id="modeToggle">
      <div class="segmented-bg"></div>
      <button class="segmented-btn active" data-mode="essays">Essay</button>
      <button class="segmented-btn" data-mode="reports">Report</button>
      <button class="segmented-btn" data-mode="reviews">Review</button>
    </div>

    <!-- PARAGRAPH AREA -->
    <div id="paragraphArea" class="paragraph-area">
      Loading...
    </div>

    <!-- Copy + Final buttons -->
    <div class="paragraph-actions">
      <button id="copyBtn" class="action-btn">Copy</button>

      <div class="opener-dropdown">
        <button id="openerToggleBtn" class="action-btn">Final ▾</button>
        <div id="openerMenu" class="opener-menu"></div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    
    <!-- Transform Buttons -->
    <div class="button-grid" id="mainButtonGrid">
      <div class="stage-button" data-transform="explain">
        <span class="stage-button-label">Explain</span>
      </div>
      <div class="stage-button" data-transform="reason">
        <span class="stage-button-label">Reason</span>
      </div>
      <div class="stage-button" data-transform="example">
        <span class="stage-button-label">Example</span>
      </div>
      <div class="stage-button" data-transform="reformulate">
        <span class="stage-button-label">Reformulate</span>
      </div>
      <div class="stage-button" data-transform="result">
        <span class="stage-button-label">Result</span>
      </div>
      <div class="stage-button" data-transform="compare">
        <span class="stage-button-label">Compare</span>
      </div>
      <div class="stage-button" data-transform="contrast">
        <span class="stage-button-label">Contrast</span>
      </div>
    </div>

    <!-- Navigation -->
    <div class="review-nav">
      <button class="nav-arrow" id="prevSentence">←</button>
      <div class="nav-dots" id="sentenceDots"></div>
      <button class="nav-arrow" id="nextSentence">→</button>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal-content-card">
    <button id="modalClose" class="action-btn" style="float:right;">Close</button>
    <h2 class="modal-title" id="contentTitle">Function</h2>
    <div id="modalContentText"></div>
  </div>
</div>
    
<script>
/* ========================================
   STATE
======================================== */
let sentencesData = [];
let currentSentenceIndex = 0;
let currentTransform = 'explain';
let currentMode = 'essays';
let paragraphText = "";
let currentOpener = "";
let openerSets = { essays: [], reports: [], reviews: [] };
let usedTransforms = {};

/* ========================================
   LINKING WORDS FOR GREEN HIGHLIGHTING
======================================== */
const linkingWords = [
  'For example', 'For instance', 'However', 'Therefore', 'Thus', 'Hence',
  'As a result', 'Consequently', 'Moreover', 'Furthermore', 'In addition',
  'Nevertheless', 'Nonetheless', 'On the other hand', 'In contrast',
  'Similarly', 'Likewise', 'In fact', 'Indeed', 'Specifically',
  'This is because', 'This happens because', 'Given that', 'Since',
  'Although', 'While', 'Whereas', 'By comparison', 'Compared to',
  'Unlike', 'In other words', 'That is to say', 'Namely'
];

/* ========================================
   HIGHLIGHT LINKING WORDS IN GREEN
======================================== */
function highlightLinkingWords(text) {
  if (!text) return '';
  
  const pattern = new RegExp(`(${linkingWords.join('|')})([,.]?)`, 'gi');
  
  return text.replace(pattern, (match) => {
    return `<span class="linking-word">${match}</span>`;
  });
}

/* ========================================
   DISPLAY PARAGRAPH TEXT
======================================== */
function updateParagraphArea() {
  const box = document.getElementById("paragraphArea");
  const baseText = sentencesData[currentSentenceIndex]?.base || '';
  let additionalText = paragraphText.replace(baseText, '').trim();
  
  // Build the poster-style base sentence
  let baseSentenceHTML = `
    <div class="base-sentence-poster">
      <div class="base-sentence-label">Core Sentence</div>
      <div class="base-sentence-icon top-left">❝</div>
      <div class="base-sentence-icon bottom-right">❞</div>
      <div class="base-sentence-text">${baseText}</div>
    </div>
  `;
  
  // Build additional content
  let additionalHTML = '';
  if (additionalText || currentOpener) {
    let fullAdditional = '';
    
    if (currentOpener) {
      fullAdditional = `<span class="opener-text">${currentOpener}</span> `;
      // Make first letter of baseText lowercase when using opener
      fullAdditional += baseText.charAt(0).toLowerCase() + baseText.slice(1);
      if (additionalText) {
        fullAdditional += ' ' + additionalText;
      }
    } else {
      fullAdditional = baseText;
      if (additionalText) {
        fullAdditional += ' ' + additionalText;
      }
    }
    
    // Highlight linking words in the full text
    additionalHTML = `<div class="additional-text">${highlightLinkingWords(fullAdditional)}</div>`;
  }
  
  box.innerHTML = baseSentenceHTML + additionalHTML;
}

/* ========================================
   LOAD DATA
======================================== */
async function init() {
  attachEventListeners();
  setupOpenerDropdown();
  await loadOpeners();
  await loadMode('essays');
}

async function loadOpeners() {
  try {
    const response = await fetch("transformations-opener-sets.json");
    openerSets = await response.json();
    rebuildOpenerMenu();
  } catch (error) {
    console.error("Error loading openers:", error);
    // Fallback to empty arrays
    openerSets = { essays: [], reports: [], reviews: [] };
  }
}

async function loadMode(mode) {
  currentMode = mode;
  updateSegmentedIndicator(mode);

  // Determine which JSON file to load based on mode
  let jsonFile;
  if (mode === 'reports') {
    jsonFile = 'transformations-reports.json';
  } else if (mode === 'reviews') {
    jsonFile = 'transformations-reviews.json';
  } else {
    jsonFile = 'transformations.json'; // essays mode
  }

  try {
    const response = await fetch(jsonFile);
    const data = await response.json();
    sentencesData = data.sentences || [];
  } catch (error) {
    console.error(`Error loading ${jsonFile}:`, error);
    sentencesData = [];
  }

  currentSentenceIndex = 0;
  usedTransforms = {};

  updateMainDisplay();
  renderNavigation();
}

/* ========================================
   UPDATE MAIN DISPLAY
======================================== */
function updateMainDisplay() {
  const sentenceObj = sentencesData[currentSentenceIndex];

  document.getElementById("sentenceCounter").textContent =
    `${currentSentenceIndex + 1} / ${sentencesData.length}`;

  if (!usedTransforms[currentSentenceIndex]) {
    usedTransforms[currentSentenceIndex] = {};
  }

  paragraphText = sentenceObj.base;
  currentOpener = "";
  
  updateParagraphArea();
  updateButtonStates();
}

/* ========================================
   UPDATE BUTTON STATES (DISABLE USED)
======================================== */
function updateButtonStates() {
  document.querySelectorAll('.stage-button').forEach(btn => {
    const transform = btn.dataset.transform;
    const isUsed = usedTransforms[currentSentenceIndex]?.[transform];
    
    if (isUsed) {
      btn.classList.add('disabled');
    } else {
      btn.classList.remove('disabled');
    }
  });
}

/* ========================================
   ADD SENTENCE TO PARAGRAPH
======================================== */
function addSentenceToParagraph(transformName, index) {
  if (usedTransforms[currentSentenceIndex]?.[transformName]) return;

  const sentenceObj = sentencesData[currentSentenceIndex];
  const list = sentenceObj[transformName] || [];
  const chosen = list[index];
  if (!chosen) return;

  paragraphText = paragraphText.trim() + " " + chosen.trim();
  updateParagraphArea();

  usedTransforms[currentSentenceIndex][transformName] = true;
  updateButtonStates();
  
  closeModal();
}

/* ========================================
   MODAL
======================================== */
function openModal(transformName) {
  // Block if already used
  if (usedTransforms[currentSentenceIndex]?.[transformName]) return;
  
  currentTransform = transformName;
  showModalContent(transformName);
  document.getElementById("modalOverlay").classList.add("show");
}

function closeModal() {
  document.getElementById("modalOverlay").classList.remove("show");
}

function showModalContent(transformName) {
  const s = sentencesData[currentSentenceIndex];
  const content = s[transformName] || [];
  const div = document.getElementById("modalContentText");

  document.getElementById("contentTitle").textContent =
    transformName.toUpperCase();

  if (!content.length) {
    div.innerHTML = "<p>No examples available.</p>";
    return;
  }

  div.innerHTML = content.map((ex, i) =>
    `<div class="modal-example-line">
       <span>${i + 1}.</span>
       <span>${ex}</span>
       <button class="use-sentence-btn" onclick="addSentenceToParagraph('${transformName}', ${i})">
         ➕ Use
       </button>
     </div>`
  ).join("");
}

/* ========================================
   SEGMENTED CONTROL
======================================== */
function updateSegmentedIndicator(mode) {
  const indicator = document.querySelector('.segmented-bg');
  const buttons = Array.from(document.querySelectorAll('.segmented-btn'));

  const index = buttons.findIndex(btn => btn.dataset.mode === mode);
  if (index === -1 || !indicator) return;

  indicator.style.transform = `translateX(${index * 100}%)`;

  buttons.forEach(btn =>
    btn.classList.toggle('active', btn.dataset.mode === mode)
  );
}

/* ========================================
   NAVIGATION
======================================== */
function renderNavigation() {
  const container = document.getElementById("sentenceDots");
  container.innerHTML = "";

  sentencesData.forEach((_, i) => {
    const dot = document.createElement("div");
    dot.className = "nav-dot" + (i === currentSentenceIndex ? " active" : "");
    dot.addEventListener("click", () => goToSentence(i));
    container.appendChild(dot);
  });
}

function goToSentence(i) {
  currentSentenceIndex = i;

  if (!usedTransforms[currentSentenceIndex]) {
    usedTransforms[currentSentenceIndex] = {};
  }

  updateMainDisplay();
  renderNavigation();
}

function changeSentence(direction) {
  const newIndex = currentSentenceIndex + direction;
  if (newIndex < 0 || newIndex >= sentencesData.length) return;
  goToSentence(newIndex);
}

/* ========================================
   OPENER DROPDOWN
======================================== */
function rebuildOpenerMenu() {
  const menu = document.getElementById("openerMenu");
  if (!menu) return;

  menu.innerHTML = "";

  const modeData = currentMode === "reports" ? openerSets.reports :
                   currentMode === "reviews" ? openerSets.reviews :
                   openerSets.essays;

  // Access the openers array from the nested structure
  const list = modeData?.openers || [];

  list.forEach(opener => {
    const btn = document.createElement("button");
    btn.className = "opener-option";
    btn.textContent = opener + "…";

    btn.addEventListener("click", () => {
      currentOpener = opener;
      updateParagraphArea();
      menu.classList.remove("show");
    });

    menu.appendChild(btn);
  });
}

function setupOpenerDropdown() {
  const toggle = document.getElementById("openerToggleBtn");
  const menu = document.getElementById("openerMenu");
  if (!toggle || !menu) return;

  toggle.addEventListener("click", (e) => {
    e.stopPropagation();
    rebuildOpenerMenu();
    menu.classList.toggle("show");
  });

  document.addEventListener("click", (e) => {
    if (!e.target.closest(".opener-dropdown")) {
      menu.classList.remove("show");
    }
  });
}

/* ========================================
   COPY PARAGRAPH
======================================== */
function copyParagraph() {
  const baseText = sentencesData[currentSentenceIndex]?.base || '';
  let additionalText = paragraphText.replace(baseText, '').trim();
  
  let fullParagraph = baseText;
  if (additionalText) {
    fullParagraph = baseText + ' ' + additionalText;
  }
  
  if (currentOpener && fullParagraph) {
    fullParagraph = currentOpener + " " + fullParagraph.charAt(0).toLowerCase() + fullParagraph.slice(1);
  }
  
  navigator.clipboard.writeText(fullParagraph);
}

/* ========================================
   EVENT LISTENERS
======================================== */
function attachEventListeners() {
  // transformation buttons
  document.querySelectorAll('.stage-button').forEach(btn =>
    btn.addEventListener("click", () => openModal(btn.dataset.transform))
  );

  // modal close
  document.getElementById("modalClose").addEventListener("click", closeModal);
  document.getElementById("modalOverlay").addEventListener("click", e => {
    if (e.target.id === "modalOverlay") closeModal();
  });

  // navigation
  document.getElementById("prevSentence").addEventListener("click", () => changeSentence(-1));
  document.getElementById("nextSentence").addEventListener("click", () => changeSentence(1));

  // segmented control
  document.querySelectorAll(".segmented-btn").forEach(btn =>
    btn.addEventListener("click", () => loadMode(btn.dataset.mode))
  );

  // copy button
  document.getElementById("copyBtn").addEventListener("click", copyParagraph);
}

/* ========================================
   START
======================================== */
init();
</script>
</body>
</html>
