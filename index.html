<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intuity Paragraph Builder</title>

  <style>
    /* -------------------------------------------
       RESET
    ------------------------------------------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 1.5rem;
    }

    /* -------------------------------------------
       CENTRAL CARD
    ------------------------------------------- */
    .central-card {
      width: 100%;
      max-width: 640px;
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(14px);
      border: 1px solid rgba(201, 169, 97, 0.18);
      border-radius: 18px;
      padding: 1.4rem;
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.35);
    }

    .central-card-title {
      font-size: 1.15rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
      color: #f1f5f9;
    }

    .central-card-subtitle {
      font-size: 0.85rem;
      margin-bottom: 0.7rem;
      color: #94a3b8;
    }

    /* -------------------------------------------
       PARAGRAPH OPENER PANEL
    ------------------------------------------- */
    .opener-panel {
      margin-bottom: 0.7rem;
    }

    .opener-label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
      margin-bottom: 0.28rem;
    }

    .opener-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.43rem;
    }

    .opener-btn {
      border: 1px solid rgba(201, 169, 97, 0.5);
      border-radius: 999px;
      padding: 0.28rem 0.7rem;
      font-size: 0.7rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .opener-btn:hover {
      background: rgba(201, 169, 97, 0.16);
    }

    .opener-btn.active {
      background: linear-gradient(135deg, #C9A961 0%, #ffa050 100%);
      color: #111827;
      border-color: transparent;
      box-shadow: 0 0 10px rgba(201, 169, 97, 0.7);
    }

    /* -------------------------------------------
       PARAGRAPH AREA
    ------------------------------------------- */
    .paragraph-area {
      margin-top: 0.8rem;
      min-height: 130px;
      padding: 0.85rem;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.22);
      font-size: 0.93rem;
      line-height: 1.45rem;
      color: #f8fafc;
      white-space: pre-wrap;
      background: rgba(255, 255, 255, 0.03);
    }

    .paragraph-area-empty {
      color: #64748b;
      font-style: italic;
    }

    /* -------------------------------------------
       COPY BUTTON
    ------------------------------------------- */
    .copy-btn {
      margin-top: 0.65rem;
      padding: 0.55rem 1rem;
      border-radius: 10px;
      background: linear-gradient(135deg, #C9A961 0%, #FF8C42 100%);
      border: none;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      color: #111827;
      width: 100%;
      transition: opacity 0.2s ease;
    }

    .copy-btn:hover {
      opacity: 0.85;
    }

    /* -------------------------------------------
       STAGE BUTTONS (Explain, Reason, etc.)
    ------------------------------------------- */
    .stage-button {
      width: 100%;
      margin: 0.4rem 0;
      padding: 0.6rem 1rem;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(201,169,97,0.35);
      border-radius: 12px;
      color: #f8fafc;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s ease;
    }

    .stage-button:hover {
      background: rgba(201, 169, 97, 0.16);
    }
    /* -------------------------------------------
       NAV DOTS
    ------------------------------------------- */
    .navigation-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 0.9rem;
      gap: 0.5rem;
    }

    .nav-dot {
      width: 10px;
      height: 10px;
      background: #475569;
      border-radius: 50%;
      cursor: pointer;
      transition: 0.2s ease;
    }

    .nav-dot.active {
      background: linear-gradient(135deg, #C9A961 0%, #ffa050 100%);
      box-shadow: 0 0 8px rgba(201, 169, 97, 0.7);
    }

    /* -------------------------------------------
       SENTENCE NAV ARROWS
    ------------------------------------------- */
    .sentence-nav {
      display: flex;
      justify-content: center;
      margin: 0.8rem 0;
      gap: 2.4rem;
    }

    .arrow-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 1.45rem;
      color: #cbd5e1;
      transition: color 0.2s ease;
    }

    .arrow-btn:hover {
      color: #f1f5f9;
    }

    /* -------------------------------------------
       MODAL OVERLAY
    ------------------------------------------- */
    #modalOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 30;
    }

    #modalOverlay.show {
      display: flex;
    }

    .modal-box {
      width: 90%;
      max-width: 520px;
      background: rgba(15,23,42,0.92);
      backdrop-filter: blur(16px);
      border-radius: 16px;
      border: 1px solid rgba(201,169,97,0.3);
      padding: 1.1rem;
      color: #e2e8f0;
      position: relative;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .modal-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .modal-close-btn {
      background: none;
      border: none;
      color: #cbd5e1;
      font-size: 1.4rem;
      cursor: pointer;
    }

    .modal-close-btn:hover {
      color: white;
    }

    /* -------------------------------------------
       MODAL CONTENT EXAMPLES
    ------------------------------------------- */
    .modal-example-line {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 0.75rem;
      line-height: 1.35rem;
    }

    .use-sentence-btn {
      background: rgba(15,23,42,0.7);
      border: 1px solid rgba(201,169,97,0.5);
      border-radius: 8px;
      padding: 0.25rem 0.6rem;
      font-size: 0.78rem;
      color: #f1f5f9;
      cursor: pointer;
      transition: background 0.15s ease, color 0.15s ease;
    }

    .use-sentence-btn:hover {
      background: rgba(201,169,97,0.2);
    }

    /* ‚≠ê Selected transform button (green checkmark look) */
    .use-sentence-btn.selected {
      background: #22c55e !important;
      border-color: #22c55e !important;
      color: #111 !important;
      font-weight: 700;
      position: relative;
    }

    .use-sentence-btn.selected::after {
      content: "‚úî";
      position: absolute;
      right: -1rem;
      top: 0;
      font-size: 1rem;
      color: #22c55e;
    }

    /* -------------------------------------------
       RESPONSIVE
    ------------------------------------------- */
    @media (max-width: 768px) {
      body {
        padding: 1rem;
      }
      .central-card {
        padding: 1rem;
      }
      .stage-button {
        font-size: 0.85rem;
      }
    }
  </style>
</head>

<body>

  <div class="central-card">

    <!-- TITLE + SUBTITLE -->
    <h2 class="central-card-title" id="sentenceBase">Loading‚Ä¶</h2>
    <p class="central-card-subtitle" id="sentenceSubtitle"></p>

    <!-- ‚≠ê NEW: PARAGRAPH OPENER PANEL -->
    <div class="opener-panel">
      <div class="opener-label">Paragraph opener</div>
      <div class="opener-chips" id="openerChips">
        <!-- dynamically inserted by JS -->
      </div>
    </div>

    <!-- ‚≠ê PARAGRAPH AREA -->
    <div id="paragraphArea" class="paragraph-area paragraph-area-empty">
      Your paragraph will appear here as you add sentences.
    </div>

    <!-- Copy paragraph -->
    <button id="copyParagraphBtn" class="copy-btn">üìã Copy</button>

    <!-- STAGE BUTTONS -->
    <div style="margin-top: 1rem;">
      <button class="stage-button" data-transform="explain">Explain</button>
      <button class="stage-button" data-transform="reason">Reason</button>
      <button class="stage-button" data-transform="example">Example</button>
      <button class="stage-button" data-transform="result">Result</button>
      <button class="stage-button" data-transform="compare">Compare</button>
      <button class="stage-button" data-transform="contrast">Contrast</button>
      <button class="stage-button" data-transform="reformulate">Reformulate</button>
    </div>

    <!-- NAVIGATION -->
    <div class="sentence-nav">
      <button class="arrow-btn" id="prevSentence">‚ùÆ</button>
      <button class="arrow-btn" id="nextSentence">‚ùØ</button>
    </div>

    <div class="navigation-wrapper" id="sentenceDots"></div>

  </div>

  <!-- ‚≠ê MODAL -->
  <div id="modalOverlay">
    <div class="modal-box">
      <div class="modal-header">
        <h3 class="modal-title" id="contentTitle">Explain</h3>
        <button id="modalClose" class="modal-close-btn">√ó</button>
      </div>

      <div id="modalContentText"></div>

    </div>
  </div>
<script>
/* ----------------------------------------------------
   STATE
---------------------------------------------------- */
let sentencesData = [];
let currentSentenceIndex = 0;
let currentTransform = 'explain';
let currentMode = 'essays';

// paragraph pieces
let openerText = "";      // e.g. "One important point is that"
let paragraphCore = "";   // base sentence + added transforms

// Track used transforms per sentence
let usedTransforms = {};

/* ----------------------------------------------------
   PARAGRAPH OPENERS PER MODE
---------------------------------------------------- */
const modeOpeners = {
  essays: [
    "One important point is that",
    "Another key idea is that",
    "A further point to consider is that",
    "It is also worth mentioning that",
    "One clear advantage is that",
    "One disadvantage is that",
    "Another reason for this is that"
  ],
  reports: [
    "The data suggests that",
    "One significant finding is that",
    "It was observed that",
    "The results indicate that",
    "A further observation is that"
  ],
  reviews: [
    "One of the main strengths is that",
    "A serious weakness is that",
    "One thing I really liked is that",
    "Another important feature is that",
    "Overall, the most impressive aspect is that"
  ]
};

/* ----------------------------------------------------
   INITIALISE
---------------------------------------------------- */
async function init() {
  attachEventListeners();
  await loadMode('essays'); // default
}

/* ----------------------------------------------------
   LOAD A MODE (ESSAY / REPORT / REVIEW)
---------------------------------------------------- */
async function loadMode(mode) {
  currentMode = mode;
  updateSegmentedIndicator(mode);

  const fileMap = {
    essays: 'transformations.json',
    reports: 'transformations-reports.json',
    reviews: 'transformations-reviews.json'
  };

  try {
    const response = await fetch(fileMap[mode]);
    const data = await response.json();

    sentencesData = data.sentences || [];
    currentSentenceIndex = 0;
    openerText = "";
    usedTransforms = {};

    updateMainDisplay();
    renderNavigation();
    renderOpeners();

  } catch (err) {
    console.error("Error loading JSON:", err);
  }
}

/* ----------------------------------------------------
   RENDER PARAGRAPH OPENERS
---------------------------------------------------- */
function renderOpeners() {
  const container = document.getElementById("openerChips");
  if (!container) return;

  container.innerHTML = "";

  const openers = modeOpeners[currentMode] || [];

  // NONE button
  const noneBtn = document.createElement("button");
  noneBtn.textContent = "No opener";
  noneBtn.className = "opener-btn" + (openerText === "" ? " active" : "");
  noneBtn.addEventListener("click", () => {
    openerText = "";
    updateParagraphArea();
    container.querySelectorAll(".opener-btn").forEach(b => b.classList.remove("active"));
    noneBtn.classList.add("active");
  });
  container.appendChild(noneBtn);

  // opener chips
  openers.forEach(openText => {
    const btn = document.createElement("button");
    btn.textContent = openText + "‚Ä¶";
    btn.className = "opener-btn" + (openerText === openText ? " active" : "");

    btn.addEventListener("click", () => {
      openerText = openText;
      updateParagraphArea();
      container.querySelectorAll(".opener-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    });

    container.appendChild(btn);
  });
}

/* ----------------------------------------------------
   UPDATE MAIN DISPLAY
---------------------------------------------------- */
function updateMainDisplay() {
  const s = sentencesData[currentSentenceIndex];

  document.getElementById("sentenceBase").textContent = s.base;
  document.getElementById("sentenceSubtitle").textContent =
    `${currentSentenceIndex + 1} / ${sentencesData.length}`;

  if (!usedTransforms[currentSentenceIndex]) {
    usedTransforms[currentSentenceIndex] = {};
  }

  paragraphCore = s.base;
  updateParagraphArea();
}

/* ----------------------------------------------------
   PARAGRAPH HANDLING
---------------------------------------------------- */
function getFullParagraphText() {
  const core = (paragraphCore || "").trim();
  if (!core) return "";

  if (openerText.trim() === "") {
    return core;
  }
  return openerText.trim() + " " + core;
}

function updateParagraphArea() {
  const box = document.getElementById("paragraphArea");
  const text = getFullParagraphText();

  if (!text.trim()) {
    box.textContent = "Your paragraph will appear here as you add sentences.";
    box.classList.add("paragraph-area-empty");
  } else {
    box.textContent = text;
    box.classList.remove("paragraph-area-empty");
  }
}

/* ----------------------------------------------------
   ADD SENTENCE FROM TRANSFORMATION
---------------------------------------------------- */
function addSentenceToParagraph(transformName, index, btn) {
  if (!usedTransforms[currentSentenceIndex]) {
    usedTransforms[currentSentenceIndex] = {};
  }

  if (usedTransforms[currentSentenceIndex][transformName]) {
    return; // already used
  }

  const s = sentencesData[currentSentenceIndex];
  const list = s.transformations?.[transformName] || [];
  const chosen = list[index];
  if (!chosen) return;

  paragraphCore = (paragraphCore.trim() + " " + chosen.trim()).trim();
  updateParagraphArea();

  usedTransforms[currentSentenceIndex][transformName] = true;

  if (btn) {
    document
      .querySelectorAll(".use-sentence-btn")
      .forEach(b => b.classList.remove("selected"));

    btn.classList.add("selected");

    const modalContent = document.getElementById("modalContentText");
    modalContent.querySelectorAll(".use-sentence-btn").forEach(b => {
      b.disabled = true;
      b.style.opacity = 0.4;
      b.style.cursor = "not-allowed";
    });
  }
}

/* ----------------------------------------------------
   MODAL (OPEN / CLOSE)
---------------------------------------------------- */
function openModal(transformName) {
  currentTransform = transformName;
  showModalContent(transformName);
  document.getElementById("modalOverlay").classList.add("show");
}

function closeModal() {
  document.getElementById("modalOverlay").classList.remove("show");
}

function showModalContent(transformName) {
  const s = sentencesData[currentSentenceIndex];
  const content = s.transformations?.[transformName] || [];
  const div = document.getElementById("modalContentText");

  document.getElementById("contentTitle").textContent = transformName.toUpperCase();

  const alreadyUsed = usedTransforms[currentSentenceIndex]?.[transformName];

  if (!content.length) {
    div.innerHTML = "<p>No examples available.</p>";
    return;
  }

  div.innerHTML = content.map((ex, i) => `
    <div class="modal-example-line">
      <span>${i + 1}.</span>
      <span>${ex}</span>
      <button class="use-sentence-btn"
              data-transform="${transformName}"
              data-index="${i}">
        ‚ûï Use
      </button>
    </div>
  `).join("");

  div.querySelectorAll(".use-sentence-btn").forEach(btn => {
    if (alreadyUsed) {
      btn.disabled = true;
      btn.style.opacity = 0.4;
      btn.style.cursor = "not-allowed";
      return;
    }
    btn.addEventListener("click", () => {
      const idx = parseInt(btn.dataset.index, 10);
      addSentenceToParagraph(transformName, idx, btn);
    });
  });
}

/* ----------------------------------------------------
   SEGMENTED CONTROL (GOLD)
---------------------------------------------------- */
function updateSegmentedIndicator(mode) {
  const indicator = document.querySelector('.segmented-bg');
  const buttons = Array.from(document.querySelectorAll('.segmented-btn'));

  const index = buttons.findIndex(btn => btn.dataset.mode === mode);
  if (index === -1 || !indicator) return;

  indicator.style.transform = `translateX(${index * 100}%)`;

  buttons.forEach(btn =>
    btn.classList.toggle('active', btn.dataset.mode === mode)
  );
}

/* ----------------------------------------------------
   NAVIGATION (DOTS & ARROWS)
---------------------------------------------------- */
function renderNavigation() {
  const container = document.getElementById("sentenceDots");
  container.innerHTML = "";

  sentencesData.forEach((_, i) => {
    const dot = document.createElement("div");
    dot.className = "nav-dot" + (i === currentSentenceIndex ? " active" : "");

    dot.addEventListener("click", () => goToSentence(i));
    container.appendChild(dot);
  });
}

function goToSentence(i) {
  currentSentenceIndex = i;

  if (!usedTransforms[currentSentenceIndex]) {
    usedTransforms[currentSentenceIndex] = {};
  }

  const s = sentencesData[currentSentenceIndex];
  paragraphCore = s.base;

  updateMainDisplay();
  renderNavigation();
}

function changeSentence(direction) {
  const newIndex = currentSentenceIndex + direction;
  if (newIndex < 0 || newIndex >= sentencesData.length) return;
  goToSentence(newIndex);
}

/* ----------------------------------------------------
   EVENT LISTENERS
---------------------------------------------------- */
function attachEventListeners() {

  document.querySelectorAll(".stage-button").forEach(btn => {
    btn.addEventListener("click", () => openModal(btn.dataset.transform));
  });

  document.getElementById("modalClose").addEventListener("click", closeModal);

  document.getElementById("modalOverlay").addEventListener("click", e => {
    if (e.target.id === "modalOverlay") closeModal();
  });

  document.getElementById("prevSentence").addEventListener("click", () => changeSentence(-1));
  document.getElementById("nextSentence").addEventListener("click", () => changeSentence(1));

  // In your real UI, you will add the segmented buttons here
  document.querySelectorAll(".segmented-btn").forEach(btn => {
    btn.addEventListener("click", () => loadMode(btn.dataset.mode));
  });

  document.getElementById("copyParagraphBtn").addEventListener("click", () => {
    const text = getFullParagraphText().trim();
    if (text) navigator.clipboard.writeText(text);
  });
}

/* ----------------------------------------------------
   START
---------------------------------------------------- */
init();
</script>

</body>
</html>
